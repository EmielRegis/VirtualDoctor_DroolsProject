package com.sample;

global QuestionCommunicator questionCommunicator;
global DiagnosisMaster diagnosis;

import org.drools.marshalling.impl.ProtobufMessages

rule "Init"
    when
    then
        System.out.println("Initializiing...");
        boolean age = questionCommunicator.createQuestion("Are you over 18 sweetheart?");
		String sex =  questionCommunicator.createSelectOptionQuestion("What's your gender?", new String[] {"male", "female"});
		diagnosis.setSex(sex);
		diagnosis.setOverEighteeen(age);
        String[] compoundAnswer = questionCommunicator.createSelectOptionsQuestion("What hurts you? Where does it hurt you?", new String[] {"chest", "stomach"});
		for(String ans : compoundAnswer.clone()) {
			insert(ans);
		}
		insert(diagnosis);
end

rule "End"
	salience(10000000)
	when dbl : Double()
	then
		drools.halt();
	end

rule "Chest"
	salience(1000)
	when s: String(s == "chest")
	then
		diagnosis.setChestPain(true);
		update(diagnosis);
end

rule "Stomach"
	salience(1000)
	when s: String(s == "stomach")
	then
		diagnosis.setStomachPain(true);
		update(diagnosis);
end

rule "Stuffiness"
    when d : DiagnosisMaster(d.isChestPain() == Question.TRUE, d.isStuffiness() == Question.NOT_ASKED )
    then
        d.setStuffiness(questionCommunicator.createQuestion("Are you sufferring from stuffiness?"));
        System.out.println(d.isStomachPain());
        update(d);
    end

rule "StuffinessAfterSports"
    when d : DiagnosisMaster(d.isStuffiness() == Question.TRUE)
    then
        d.setSportStuffiness(questionCommunicator.createQuestion("Do your breathing problems escalate after doing sports?"));
        update(d);
    end 
    
rule "BloodPressure"
    when d : DiagnosisMaster(d.isSportStuffiness() == Question.TRUE)
    then
        d.setBloodPressure(questionCommunicator.createQuestion("Is your blood pressure ok?"));
        update(d);
    end 
    
rule "Pulmonologist"
    when d : DiagnosisMaster(d.isBloodPressure() == Question.TRUE)
    then
        System.out.println("Pulmonologist");
    end 
    
rule "Cardiologist"
    when d : DiagnosisMaster(d.isBloodPressure() == Question.FALSE)
    then
        System.out.println("Cardiologist");
    end       
//--9 
rule "Abdomen" //podbrzusze
    when d : DiagnosisMaster(d.isStomachPain() == Question.TRUE)
    then
        d.setAbdomen(questionCommunicator.createQuestion("Does your abdomen hurt?"));
        update(d);
    end

rule "Meal"
	when d : DiagnosisMaster(d.isAbdomen() == Question.FALSE)
	then
		d.setMeal(questionCommunicator.createQuestion("Is your pain connected with meals you eat?"));
		System.out.println(d.isChestPain());
		update(d);
	end

rule "Nausea" //nudnosci
    when d : DiagnosisMaster(d.isMeal() == Question.TRUE)
    then
        d.setNausea(questionCommunicator.createQuestion("Do you feel nauseous?"));
        update(d);
    end

rule "Gastrologist"
    when d : DiagnosisMaster(d.isNausea() == Question.TRUE)
    then
       	questionCommunicator.createNoCallbackNotification("Gastrologist");
       	drools.halt();
        System.out.println("Gastrologist");
    end 

rule "Voiding"
	when d : DiagnosisMaster(d.isAbdomen() == Question.TRUE, d.isVoiding() == Question.NOT_ASKED )
	then
		d.setVoiding(questionCommunicator.createQuestion("Is your pain connected with the voiding?"));
		System.out.println(d.isChestPain());
		update(d);
	end
